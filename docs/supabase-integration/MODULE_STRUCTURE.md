# Supabase é›†æˆ - æ¨¡å—åŒ–ç»“æ„è®¾è®¡

## ğŸ“¦ æ¨¡å—åˆ’åˆ†

### æ¨¡å—åˆ—è¡¨

| æ¨¡å— | åŠŸèƒ½èŒƒå›´ | ä¼˜å…ˆçº§ | ä¾èµ–å…³ç³» |
|------|----------|--------|----------|
| **1. åŸºç¡€è®¾æ–½æ¨¡å—** | Supabase é…ç½®ã€è®¤è¯åŸºç¡€ | P0 | æ—  |
| **2. ç”¨æˆ·æ¨¡å—** | ç”¨æˆ·èµ„æ–™ã€è¿›åº¦ã€è®¾ç½® | P0 | ä¾èµ– 1 |
| **3. ç»ƒä¹ æ¨¡å—** | ç»ƒä¹ è®°å½•ã€å­—æ¯ç»Ÿè®¡ | P0 | ä¾èµ– 1, 2 |
| **4. æ¸¸æˆæ¨¡å—** | æ¸¸æˆè®°å½• | P1 | ä¾èµ– 1, 2 |
| **5. ç§¯åˆ†æ¨¡å—** | ç§¯åˆ†ç®¡ç†ã€ç§¯åˆ†è®°å½• | P1 | ä¾èµ– 1, 2 |
| **6. ç¤¼ç‰©æ¨¡å—** | ç¤¼ç‰©ç®¡ç†ã€å…‘æ¢è®°å½• | P1 | ä¾èµ– 1, 2, 5 |
| **7. æˆå°±æ¨¡å—** | æˆå°±ç³»ç»Ÿ | P1 | ä¾èµ– 1, 2 |
| **8. å®¶é•¿æ¨¡å—** | å®¶é•¿-å­¦ç”Ÿå…³è”ã€å®¶é•¿åŠŸèƒ½ | P2 | ä¾èµ– 1, 2, 3 |
| **9. èµ„æºæ¨¡å—** | å­—æ¯ã€è¯»éŸ³ã€å•è¯ã€å¥å­ã€è¯¾æœ¬ç­‰èµ„æº | P2 | ä¾èµ– 1 |

---

## ğŸ” æ¨¡å—è¯¦ç»†è¯´æ˜

### 1. åŸºç¡€è®¾æ–½æ¨¡å— (Infrastructure)

**åŠŸèƒ½**ï¼š
- Supabase å®¢æˆ·ç«¯åˆå§‹åŒ–
- è®¤è¯æœåŠ¡ï¼ˆæ³¨å†Œã€ç™»å½•ã€ç™»å‡ºã€ä¼šè¯ç®¡ç†ï¼‰
- ç¯å¢ƒå˜é‡é…ç½®
- ç±»å‹å®šä¹‰ç”Ÿæˆ
- RLS ç­–ç•¥åŸºç¡€é…ç½®

**æ•°æ®åº“è¡¨**ï¼š
- æ— ï¼ˆä½¿ç”¨ Supabase Auth å†…ç½®è¡¨ï¼‰

**API æ¥å£**ï¼š
- `initSupabaseClient()` - åˆå§‹åŒ–å®¢æˆ·ç«¯
- `signUp()` - ç”¨æˆ·æ³¨å†Œ
- `signIn()` - ç”¨æˆ·ç™»å½•
- `signOut()` - ç”¨æˆ·ç™»å‡º
- `getSession()` - è·å–ä¼šè¯
- `resetPassword()` - é‡ç½®å¯†ç 

**ä»£ç ä½ç½®**ï¼š
```
src/services/supabase/
src/services/auth/
```

---

### 2. ç”¨æˆ·æ¨¡å— (User)

**åŠŸèƒ½**ï¼š
- ç”¨æˆ·èµ„æ–™ç®¡ç†
- ç”¨æˆ·è¿›åº¦ç®¡ç†
- ç”¨æˆ·è®¾ç½®ç®¡ç†
- ç”¨æˆ·æ•°æ®åŒæ­¥

**æ•°æ®åº“è¡¨**ï¼š
- `user_profiles` - ç”¨æˆ·èµ„æ–™
- `user_progress` - ç”¨æˆ·è¿›åº¦

**API æ¥å£**ï¼š
- `getUserProfile(userId)` - è·å–ç”¨æˆ·èµ„æ–™
- `updateUserProfile(userId, data)` - æ›´æ–°ç”¨æˆ·èµ„æ–™
- `getUserProgress(userId)` - è·å–ç”¨æˆ·è¿›åº¦
- `updateUserProgress(userId, data)` - æ›´æ–°ç”¨æˆ·è¿›åº¦

**ä»£ç ä½ç½®**ï¼š
```
src/services/api/user.api.ts
src/stores/user.ts (ä¿®æ”¹)
```

---

### 3. ç»ƒä¹ æ¨¡å— (Exercise)

**åŠŸèƒ½**ï¼š
- ç»ƒä¹ è®°å½•ç®¡ç†
- å­—æ¯ç»Ÿè®¡ç®¡ç†
- ç»ƒä¹ æ•°æ®åŒæ­¥

**æ•°æ®åº“è¡¨**ï¼š
- `exercise_records` - ç»ƒä¹ è®°å½•
- `letter_stats` - å­—æ¯ç»Ÿè®¡

**API æ¥å£**ï¼š
- `saveExerciseRecord(userId, record)` - ä¿å­˜ç»ƒä¹ è®°å½•
- `getExerciseRecords(userId, options)` - è·å–ç»ƒä¹ è®°å½•åˆ—è¡¨
- `batchUpdateLetterStats(userId, stats)` - æ‰¹é‡æ›´æ–°å­—æ¯ç»Ÿè®¡
- `getLetterStats(userId)` - è·å–å­—æ¯ç»Ÿè®¡

**ä»£ç ä½ç½®**ï¼š
```
src/services/api/exercise.api.ts
src/stores/exercise.ts (ä¿®æ”¹)
```

---

### 4. æ¸¸æˆæ¨¡å— (Game)

**åŠŸèƒ½**ï¼š
- æ¸¸æˆè®°å½•ç®¡ç†
- æ¸¸æˆæ•°æ®åŒæ­¥

**æ•°æ®åº“è¡¨**ï¼š
- `game_records` - æ¸¸æˆè®°å½•

**API æ¥å£**ï¼š
- `saveGameRecord(userId, gameType, record)` - ä¿å­˜æ¸¸æˆè®°å½•
- `getGameRecord(userId, gameType, date)` - è·å–æ¸¸æˆè®°å½•
- `getGameRecords(userId, options)` - è·å–æ¸¸æˆè®°å½•åˆ—è¡¨

**ä»£ç ä½ç½®**ï¼š
```
src/services/api/game.api.ts
src/stores/game.ts (ä¿®æ”¹)
```

---

### 5. ç§¯åˆ†æ¨¡å— (Points)

**åŠŸèƒ½**ï¼š
- ç§¯åˆ†ç®¡ç†
- ç§¯åˆ†è®°å½•
- ç§¯åˆ†è®¡ç®—è§„åˆ™

**æ•°æ®åº“è¡¨**ï¼š
- `points_transactions` - ç§¯åˆ†äº¤æ˜“è®°å½•ï¼ˆæ–°å¢ï¼‰
- `user_progress` - ç”¨æˆ·è¿›åº¦ï¼ˆåŒ…å«ç§¯åˆ†å­—æ®µï¼‰

**API æ¥å£**ï¼š
- `getUserPoints(userId)` - è·å–ç”¨æˆ·ç§¯åˆ†
- `addPoints(userId, amount, reason)` - å¢åŠ ç§¯åˆ†
- `deductPoints(userId, amount, reason)` - æ‰£é™¤ç§¯åˆ†
- `getPointsHistory(userId, options)` - è·å–ç§¯åˆ†å†å²

**ä»£ç ä½ç½®**ï¼š
```
src/services/api/points.api.ts
src/stores/user.ts (ä¿®æ”¹ï¼Œæ·»åŠ ç§¯åˆ†ç®¡ç†)
```

**è¯´æ˜**ï¼š
- ç§¯åˆ†å¯ä»¥é›†æˆåœ¨ç”¨æˆ·æ¨¡å—ä¸­ï¼Œä½†ç‹¬ç«‹æ¨¡å—æ›´æ¸…æ™°
- ç§¯åˆ†äº¤æ˜“è®°å½•å¯ä»¥ç”¨äºå®¡è®¡å’Œç»Ÿè®¡

---

### 6. ç¤¼ç‰©æ¨¡å— (Gift)

**åŠŸèƒ½**ï¼š
- ç¤¼ç‰©ç®¡ç†ï¼ˆç³»ç»Ÿçº§ï¼‰
- ç¤¼ç‰©å…‘æ¢
- å…‘æ¢è®°å½•

**æ•°æ®åº“è¡¨**ï¼š
- `gifts` - ç¤¼ç‰©ï¼ˆç³»ç»Ÿè¡¨ï¼‰
- `redeemed_gifts` - å·²å…‘æ¢ç¤¼ç‰©

**API æ¥å£**ï¼š
- `getAvailableGifts()` - è·å–å¯ç”¨ç¤¼ç‰©åˆ—è¡¨
- `getGiftById(giftId)` - è·å–ç¤¼ç‰©è¯¦æƒ…
- `redeemGift(userId, giftId)` - å…‘æ¢ç¤¼ç‰©
- `getRedeemedGifts(userId)` - è·å–ç”¨æˆ·å…‘æ¢è®°å½•

**ä»£ç ä½ç½®**ï¼š
```
src/services/api/gift.api.ts
src/stores/user.ts (ä¿®æ”¹ï¼Œæ·»åŠ ç¤¼ç‰©ç®¡ç†)
```

**ä¾èµ–**ï¼š
- ä¾èµ–ç§¯åˆ†æ¨¡å—ï¼ˆå…‘æ¢éœ€è¦æ‰£é™¤ç§¯åˆ†ï¼‰

---

### 7. æˆå°±æ¨¡å— (Achievement)

**åŠŸèƒ½**ï¼š
- æˆå°±ç®¡ç†
- æˆå°±è§£é”
- æˆå°±ç»Ÿè®¡

**æ•°æ®åº“è¡¨**ï¼š
- `achievements` - æˆå°±è®°å½•
- `achievement_definitions` - æˆå°±å®šä¹‰ï¼ˆç³»ç»Ÿè¡¨ï¼Œå¯é€‰ï¼‰

**API æ¥å£**ï¼š
- `unlockAchievement(userId, achievementId)` - è§£é”æˆå°±
- `getUserAchievements(userId)` - è·å–ç”¨æˆ·æˆå°±åˆ—è¡¨
- `getAchievementDefinitions()` - è·å–æˆå°±å®šä¹‰åˆ—è¡¨ï¼ˆå¦‚æœä½¿ç”¨ç³»ç»Ÿè¡¨ï¼‰

**ä»£ç ä½ç½®**ï¼š
```
src/services/api/achievement.api.ts
src/stores/user.ts (ä¿®æ”¹ï¼Œæ·»åŠ æˆå°±ç®¡ç†)
```

---

### 8. å®¶é•¿æ¨¡å— (Parent)

**åŠŸèƒ½**ï¼š
- å®¶é•¿-å­¦ç”Ÿå…³è”
- å®¶é•¿æŸ¥çœ‹å­¦ç”Ÿæ•°æ®
- å®¶é•¿æƒé™ç®¡ç†

**æ•°æ®åº“è¡¨**ï¼š
- `parent_student_relations` - å®¶é•¿-å­¦ç”Ÿå…³è”
- `user_profiles` - ç”¨æˆ·èµ„æ–™ï¼ˆæ·»åŠ  role å­—æ®µï¼‰

**API æ¥å£**ï¼š
- `getUserRole(userId)` - è·å–ç”¨æˆ·è§’è‰²
- `updateUserRole(userId, role)` - æ›´æ–°ç”¨æˆ·è§’è‰²
- `getStudentList(parentId)` - è·å–å…³è”å­¦ç”Ÿåˆ—è¡¨
- `addStudentRelation(parentId, studentId)` - æ·»åŠ å­¦ç”Ÿå…³è”
- `removeStudentRelation(parentId, studentId)` - ç§»é™¤å­¦ç”Ÿå…³è”
- `getStudentProgress(parentId, studentId)` - æŸ¥çœ‹å­¦ç”Ÿè¿›åº¦
- `getStudentExerciseRecords(parentId, studentId)` - æŸ¥çœ‹å­¦ç”Ÿç»ƒä¹ è®°å½•
- `getStudentGameRecords(parentId, studentId)` - æŸ¥çœ‹å­¦ç”Ÿæ¸¸æˆè®°å½•

**ä»£ç ä½ç½®**ï¼š
```
src/services/api/parent.api.ts
src/stores/parent.ts (æ–°å¢)
```

**ä¾èµ–**ï¼š
- ä¾èµ–ç”¨æˆ·æ¨¡å—
- ä¾èµ–ç»ƒä¹ æ¨¡å—
- ä¾èµ–æ¸¸æˆæ¨¡å—

---

### 9. èµ„æºæ¨¡å— (Resource)

**åŠŸèƒ½**ï¼š
- å­—æ¯èµ„æºç®¡ç†
- è¯»éŸ³èµ„æºç®¡ç†
- å•è¯èµ„æºç®¡ç†
- å¥å­èµ„æºç®¡ç†
- è¯¾æœ¬èµ„æºç®¡ç†ï¼ˆæœªæ¥æ‰©å±•ï¼‰

**æ•°æ®åº“è¡¨**ï¼š
- `pronunciation_resources` - å‘éŸ³èµ„æº
- `word_resources` - å•è¯èµ„æºï¼ˆæ–°å¢ï¼‰
- `sentence_resources` - å¥å­èµ„æºï¼ˆæ–°å¢ï¼‰
- `textbook_resources` - è¯¾æœ¬èµ„æºï¼ˆæ–°å¢ï¼Œæœªæ¥ï¼‰
- `resource_categories` - èµ„æºåˆ†ç±»ï¼ˆæ–°å¢ï¼Œå¯é€‰ï¼‰

**API æ¥å£**ï¼š
- `getLetterPronunciation(letter, language?)` - è·å–å­—æ¯å‘éŸ³
- `getWordPronunciation(word, language?)` - è·å–å•è¯å‘éŸ³
- `getSentencePronunciation(sentence, language?)` - è·å–å¥å­å‘éŸ³
- `getWordResource(word)` - è·å–å•è¯èµ„æº
- `getSentenceResource(sentence)` - è·å–å¥å­èµ„æº
- `getTextbookResources(options?)` - è·å–è¯¾æœ¬èµ„æºåˆ—è¡¨ï¼ˆæœªæ¥ï¼‰
- `getResourceByCategory(category)` - æŒ‰åˆ†ç±»è·å–èµ„æºï¼ˆå¯é€‰ï¼‰

**ä»£ç ä½ç½®**ï¼š
```
src/services/api/resource.api.ts
src/stores/resource.ts (æ–°å¢)
```

**å­˜å‚¨æ–¹æ¡ˆ**ï¼š
- éŸ³é¢‘æ–‡ä»¶ï¼šSupabase Storage
- æ–‡æœ¬èµ„æºï¼šæ•°æ®åº“è¡¨
- å›¾ç‰‡èµ„æºï¼šSupabase Storage

---

## ğŸ“Š æ¨¡å—ä¾èµ–å…³ç³»å›¾

```
åŸºç¡€è®¾æ–½æ¨¡å— (1)
    â†“
ç”¨æˆ·æ¨¡å— (2) â”€â”€â”
    â†“          â”‚
ç»ƒä¹ æ¨¡å— (3) â†â”€â”˜
    â†“
æ¸¸æˆæ¨¡å— (4) â†â”€â”
    â†“          â”‚
ç§¯åˆ†æ¨¡å— (5) â†â”€â”˜
    â†“
ç¤¼ç‰©æ¨¡å— (6) â†â”€â”
    â†“          â”‚
æˆå°±æ¨¡å— (7) â†â”€â”˜
    â†“
å®¶é•¿æ¨¡å— (8) â†â”€â”
    â†“          â”‚
èµ„æºæ¨¡å— (9) â†â”€â”˜
```

---

## âœ… æ¨¡å—åˆ’åˆ†åˆç†æ€§æ£€æŸ¥

### ä¼˜ç‚¹

1. **èŒè´£æ¸…æ™°**ï¼šæ¯ä¸ªæ¨¡å—èŒè´£å•ä¸€ï¼Œè¾¹ç•Œæ˜ç¡®
2. **ä¾èµ–åˆç†**ï¼šæ¨¡å—é—´ä¾èµ–å…³ç³»æ¸…æ™°ï¼Œæ— å¾ªç¯ä¾èµ–
3. **å¯æ‰©å±•**ï¼šèµ„æºæ¨¡å—è®¾è®¡æ”¯æŒæœªæ¥æ‰©å±•ï¼ˆè¯¾æœ¬ç­‰ï¼‰
4. **å¯æµ‹è¯•**ï¼šæ¯ä¸ªæ¨¡å—å¯ç‹¬ç«‹æµ‹è¯•
5. **å¯ç»´æŠ¤**ï¼šæ¨¡å—åŒ–ä¾¿äºç»´æŠ¤å’Œè¿­ä»£

### å»ºè®®è°ƒæ•´

1. **ç§¯åˆ†æ¨¡å—**ï¼š
   - é€‰é¡¹ Aï¼šç‹¬ç«‹æ¨¡å—ï¼ˆå½“å‰è®¾è®¡ï¼‰âœ… æ¨è
   - é€‰é¡¹ Bï¼šé›†æˆåˆ°ç”¨æˆ·æ¨¡å—ï¼ˆç®€åŒ–è®¾è®¡ï¼‰
   - **å»ºè®®**ï¼šä¿æŒç‹¬ç«‹ï¼Œä¾¿äºåç»­æ‰©å±•ç§¯åˆ†è§„åˆ™å’Œç»Ÿè®¡

2. **èµ„æºæ¨¡å—**ï¼š
   - æ˜¯å¦éœ€è¦ç»†åˆ†ï¼Ÿ
   - é€‰é¡¹ Aï¼šç»Ÿä¸€èµ„æºæ¨¡å—ï¼ˆå½“å‰è®¾è®¡ï¼‰âœ… æ¨è
   - é€‰é¡¹ Bï¼šå‘éŸ³èµ„æºã€æ–‡æœ¬èµ„æºåˆ†å¼€
   - **å»ºè®®**ï¼šç»Ÿä¸€ç®¡ç†ï¼Œé€šè¿‡ `resource_type` å­—æ®µåŒºåˆ†

3. **æˆå°±æ¨¡å—**ï¼š
   - æ˜¯å¦éœ€è¦æˆå°±å®šä¹‰è¡¨ï¼Ÿ
   - é€‰é¡¹ Aï¼šå‰ç«¯å®šä¹‰ï¼ˆå½“å‰ï¼‰âœ… æ¨è
   - é€‰é¡¹ Bï¼šæ•°æ®åº“å®šä¹‰ï¼ˆä¾¿äºåŠ¨æ€ç®¡ç†ï¼‰
   - **å»ºè®®**ï¼šå½“å‰é˜¶æ®µå‰ç«¯å®šä¹‰ï¼Œæœªæ¥å¯æ‰©å±•æ•°æ®åº“å®šä¹‰

---

## ğŸ¯ å®æ–½é¡ºåºå»ºè®®

### Phase 1: æ ¸å¿ƒæ¨¡å—ï¼ˆå¿…é¡»ï¼‰
1. åŸºç¡€è®¾æ–½æ¨¡å—
2. ç”¨æˆ·æ¨¡å—
3. ç»ƒä¹ æ¨¡å—

### Phase 2: æ‰©å±•æ¨¡å—ï¼ˆé‡è¦ï¼‰
4. æ¸¸æˆæ¨¡å—
5. ç§¯åˆ†æ¨¡å—
6. ç¤¼ç‰©æ¨¡å—
7. æˆå°±æ¨¡å—

### Phase 3: é«˜çº§åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰
8. å®¶é•¿æ¨¡å—
9. èµ„æºæ¨¡å—

---

## ğŸ“ ä¸‹ä¸€æ­¥

1. âœ… ç¡®è®¤æ¨¡å—åˆ’åˆ†æ˜¯å¦åˆç†
2. â³ æŒ‰æ¨¡å—é‡æ„ specs ç›®å½•ç»“æ„
3. â³ æŒ‰æ¨¡å—æ›´æ–° design.md
4. â³ æŒ‰æ¨¡å—æ›´æ–° tasks.md
