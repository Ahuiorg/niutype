# 游戏模块设计文档

## Context
打字小达人应用需要添加游戏模块来增加用户粘性和趣味性。第一个游戏是复古像素风格的贪吃蛇游戏，需要与现有的打字练习功能集成，同时保持独立的设计和实现。

## Goals / Non-Goals

### Goals
- 提供每天30分钟的游戏时间限制
- 实现字母主题的贪吃蛇游戏（食物和蛇身都是字母）
- 实现复古像素风格的视觉设计
- 支持键盘和触摸屏控制
- 响应式设计，适配各种屏幕尺寸
- 与现有打字练习功能独立，不影响核心功能

### Non-Goals
- 不实现多人游戏功能
- 不实现游戏排行榜（当前阶段）
- 不实现游戏内购买或付费功能
- 不实现游戏成就系统（可后续添加）

## Decisions

### Decision: 游戏时间追踪与打字练习时间分离
**What**: 游戏时间与打字练习时间分开追踪，每天各有30分钟限制。

**Why**: 
- 保持游戏和练习功能的独立性
- 用户可以分别管理练习时间和游戏时间
- 便于后续扩展不同类型的游戏

**Alternatives considered**:
- 共享30分钟时间：被拒绝，因为会限制用户体验
- 无时间限制：被拒绝，因为需要控制使用时间

### Decision: 使用 Canvas 渲染游戏画面
**What**: 使用 HTML5 Canvas API 渲染贪吃蛇游戏。

**Why**:
- Canvas 提供精确的像素级控制，适合像素风格游戏
- 性能好，适合实时游戏渲染
- 可以轻松实现半调图案等视觉效果

**Alternatives considered**:
- SVG：被拒绝，因为性能不如 Canvas，且像素风格控制不够精确
- DOM 元素：被拒绝，因为大量 DOM 操作性能差

### Decision: 游戏状态管理使用 Pinia Store
**What**: 创建独立的 `game.ts` store 管理游戏相关状态。

**Why**:
- 与现有架构保持一致（项目已使用 Pinia）
- 便于状态持久化和跨组件共享
- 符合项目规范

**Alternatives considered**:
- 组件内状态：被拒绝，因为需要跨组件共享和持久化
- 全局变量：被拒绝，因为不符合 Vue 3 最佳实践

### Decision: 游戏时间数据存储在 localStorage
**What**: 游戏时间追踪数据存储在 localStorage，与用户数据一起持久化。

**Why**:
- 与现有数据存储方式一致
- 纯前端应用，无需后端
- 简单可靠

**Alternatives considered**:
- IndexedDB：被拒绝，因为数据量小，localStorage 足够
- 后端存储：被拒绝，因为项目是纯前端应用

### Decision: 像素风格使用 CSS 和 Canvas 结合
**What**: 像素风格通过 CSS 样式（字体、边框）和 Canvas 绘制（游戏元素）结合实现。

**Why**:
- CSS 适合 UI 元素样式（标题、按钮、边框）
- Canvas 适合游戏画面渲染
- 两者结合可以统一视觉风格

**Alternatives considered**:
- 纯 Canvas：被拒绝，因为 UI 元素用 Canvas 实现复杂且不灵活
- 纯 CSS：被拒绝，因为游戏画面需要 Canvas 的精确控制

### Decision: 游戏采用字母主题
**What**: 贪吃蛇游戏的食物是随机字母，蛇身由被吃的字母组成。

**Why**:
- 与打字练习应用的主题一致
- 增加教育意义，让用户在游戏中看到字母
- 增强游戏的趣味性和独特性
- 可以后续扩展为打字练习相关的游戏机制

**Alternatives considered**:
- 传统食物方块：被拒绝，因为与打字主题无关
- 数字主题：被拒绝，因为应用主要关注字母学习

## Risks / Trade-offs

### Risk: 游戏时间限制可能影响用户体验
**Mitigation**: 
- 清晰显示剩余游戏时间
- 时间用完后给出友好提示
- 可以考虑后续添加"完成练习获得额外游戏时间"的机制

### Risk: Canvas 性能问题
**Mitigation**:
- 使用 requestAnimationFrame 优化渲染
- 限制游戏区域大小
- 避免不必要的重绘
- 使用离屏 Canvas 缓存静态元素

### Risk: 触摸屏控制体验不佳
**Mitigation**:
- 提供大尺寸触摸按钮
- 支持滑动手势控制
- 在移动端测试和优化

### Trade-off: 游戏复杂度 vs 开发时间
**Decision**: 先实现核心功能，后续可以添加更多特效和功能。

## Migration Plan

### 数据迁移
- 无需迁移，这是新功能
- 新用户自动获得游戏模块访问权限
- 现有用户数据不受影响

### 代码集成
1. 添加游戏相关路由
2. 添加游戏 Store
3. 更新导航菜单
4. 添加游戏页面组件

### 向后兼容
- 完全向后兼容
- 不影响现有打字练习功能
- 游戏模块是可选的，用户可以不使用

## Open Questions
- 是否需要游戏成就系统？（后续考虑）
- 是否需要游戏排行榜？（后续考虑）
- 是否需要更多游戏类型？（后续添加）
